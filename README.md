# kast [![Build Status](https://travis-ci.org/akoenig/kast.svg)](https://travis-ci.org/akoenig/kast)

An UDP multicast RPC framework.

## Usage example

Let's say we want to start two `kast` servers, each of which provides a command to check if they are alive.

### Host A

```javascript
var kast = require('kast');

var server = kast();

server.command('/alive', function (req, res) {
    res.send('Hey! Host A is alive!');
});

server.listen(5000);
```

### Host B

```javascript
var kast = require('kast');

var server = kast();

server.command('/alive', function (req, res) {
    res.send('This is Host B speaking! How can I help you?');
});

server.listen(5000);
```

### Client

A client can now send a _broadcast request_ to all the hosts without knowing each individual ip address / host name.

```javascript
var kast = require('kast');

kast.broadcast({
    port: 5000,
    command: '/alive',
}, function onResults (err, results) {
    console.log(results);
});
```

The results of the hosts which have responded in a timely manner will be collected in the `results` argument, like:

```javascript
{
    '10.0.0.1': 'Hey! Host A is alive!',
    '10.0.0.23': 'This is Host B speaking! How can I help you?'
}
```

## API

### Install

```sh
$ npm install --save kast
```

### Basic usage

```javascript

var kast = require('kast');

var server = kast();
```

### Creating a server instance

#### server.listen(port, [host], [callback])

Binds and listens for new connections on the given host and post. Please note that the `host` parameter is optional. `kast` uses `224.1.1.1` as a default multicast group.

The `callback` function will be executed after the binding process has been finished as `callback(err)`.

This method will return an instance of `Socket` which exposes the following API:

##### socket.close(callback)

Possibility for shutting the whole `kast` server down.

### Registering commands

#### server.command(name, handlerFn)

The `handlerFn` will receive two ordinary parameters: A `req`uest and a `res`ponse parameter. This will look familiar if you have worked with [Express](http://expressjs.com/) before.

##### Request

###### req.id

An unique request id (will be generated by `kast`).

###### req.connection.remoteAddress

The ip address of the host, which has sent the request.

###### req.connection.remotePort

The remote port of the host, which has sent the request.

###### req.command

The `name` of the command.

###### req.body

A possible request body with additional data (comparable with the HTTP request body).

##### Response

###### res.send(body)

Sends a response with the given `body` as string.

## Development

### Tests

In order run the test suite, install the dependencies first, then run `npm test`:

```sh
$ npm install
$ npm test
```

## License

MIT © 2014, [André König](http://andrekoenig.info) (andre.koenig@posteo.de)
